<!DOCTYPE html>
<html>
  <head>
    <title>Force-Directed Layout (Multiple Foci)</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
    <script>
        var sortAttr = 'stakeholder';
    var categories = {
        micro: {
            name: 'Micro',
            subcategories: {
                access: {
                    name: 'Accessibility'
                },
                learning: {
                    name: 'Learning & Teaching'
                }
            }
        },
        macro: {
            name: 'Macro',
            subcategories: {
                support: {
                    name: 'Supportive Policies'
                },
                community: {
                    name: 'Community Building'
                }
            }
        },
        meso: {
            name: 'Meso',
            subcategories: {
                tools: {
                    name: 'Tools & Technology'
                },
                copyright: {
                    name: 'Copyright & Licensing'
                }
            }
        },
        research: {
            name: 'Research',
            subcategories: {
                standards: {
                    name: 'Standards & Quality Control'
                },
                assessment: {
                    name: 'Assessment'
                }
            }
        }
    };

    var stakeholders = {
        student: {
            name: 'Student'
        },
        teacher: {
            name: 'Teacher'
        },
        supporter: {
            name: 'Supporter'
        }
    };

    var quotes = [
        {
            category: 'micro',
            subcategory: 'learning',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'meso',
            subcategory: 'tools',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'macro',
            subcategory: 'community',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'macro',
            subcategory: 'support',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'research',
            subcategory: 'standards',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'research',
            subcategory: 'assessment',
            stakeholder: 'supporter',
            quote: 'I think x and y.'
        },
        {
            category: 'meso',
            subcategory: 'copyright',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'micro',
            subcategory: 'access',
            stakeholder: 'supporter',
            quote: 'I think x and y.'
        },
        {
            category: 'micro',
            subcategory: 'learning',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'meso',
            subcategory: 'tools',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'macro',
            subcategory: 'community',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'macro',
            subcategory: 'support',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'research',
            subcategory: 'standards',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'research',
            subcategory: 'assessment',
            stakeholder: 'supporter',
            quote: 'I think x and y.'
        },
        {
            category: 'meso',
            subcategory: 'copyright',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'micro',
            subcategory: 'access',
            stakeholder: 'supporter',
            quote: 'I think x and y.'
        },
        {
            category: 'micro',
            subcategory: 'learning',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'meso',
            subcategory: 'tools',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'macro',
            subcategory: 'community',
            stakeholder: 'student',
            quote: 'I think x and y.'
        },
        {
            category: 'macro',
            subcategory: 'support',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'research',
            subcategory: 'standards',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'research',
            subcategory: 'assessment',
            stakeholder: 'supporter',
            quote: 'I think x and y.'
        },
        {
            category: 'meso',
            subcategory: 'copyright',
            stakeholder: 'teacher',
            quote: 'I think x and y.'
        },
        {
            category: 'micro',
            subcategory: 'access',
            stakeholder: 'supporter',
            quote: 'I think x and y.'
        }
    ];

    var sizes = {
        micro: 12,
        meso: 12,
        macro: 12,
        research: 12
    };

    var foci = {
        'teacher': [160, 250],
        'student': [490,250],
        'supporter': [830, 250],
        'micro': [330, 200],
        'meso': [660,200],
        'macro': [330, 400],
        'research': [660, 400],
    };

    var colors = {
    };

    </script>
  </head>
  <body>
    <div id="data">
        A <span id="stakeholder"></span> says:
        <div id="quote"></div>
    </div>
    <ul id="categories"></ul>
    <ul id="stakeholders"></ul>
    Sort by:
    <label for="sortCat">Category</label><input type="radio" name="sort" id="sortCat" value="category" />
    <label for="sortStake">Stakeholder</label><input type="radio" name="sort" id="sortStake" checked="checked" value="stakeholder" />
    <script type="text/javascript">

        function getCatColor(arg) {
            var sum = 0;
            for (i=0; i < arg.length; i++) {
                sum += arg.charCodeAt(i);
            }
            return sum;
        }

        function getSubcatColor(node) {
            var colorDelta = d3.keys(categories[node.category].subcategories).indexOf(node.subcategory);
            return d3.rgb(fill(getCatColor(node.category))).brighter(colorDelta); 
        }

    var w = 960,
        h = 600,
        fill = d3.scale.category10(),
        nodes = quotes;

    var vis = d3.select("body").insert("svg:svg", "div")
        .attr("width", w)
        .attr("height", h);

    var force = d3.layout.force()
        .nodes(nodes)
        .links([])
        .size([w, h])
        .gravity(0)
        .start();

    var node = vis.selectAll("circle.node")
        .data(nodes)
      .enter().append("svg:circle")
        .attr("class", "node")
        .attr("cx", function(d) { return foci[d.stakeholder][0]; })
        .attr("cy", function(d) { return foci[d.stakeholder][1]; })
        .attr("r", function(d) { return sizes[d.category]; })
        .style("fill", function(d, i) { return getSubcatColor(d); })
        .style("stroke", function(d, i) { return getSubcatColor(d).darker(2); })
        .style("stroke-width", 1.5)
        .call(force.drag);

    vis.style("opacity", 1e-6)
      .transition()
        .duration(1000)
        .style("opacity", 1);

    force.on("tick", function(e) {

     var k = .05 * e.alpha;
      nodes.forEach(function(o, i) {
        o.y += (foci[o[sortAttr]][1] - o.y) * k;
        o.x += (foci[o[sortAttr]][0] - o.x) * k;
      });

      vis.selectAll("circle.node")
          .attr("cx", function(d) { return d.x; })
          .attr("cy", function(d) { return d.y; });
    });

    d3.selectAll("circle.node").on("mouseover", function(c) {
        d3.select("#quote").text(c.quote);
        d3.select("#stakeholder").text(stakeholders[c.stakeholder].name);
        $('#data').show();
        }).on("mouseout", function() { $('#data').hide(); });

    $("input[type=radio]").on("change", function(e) {
        sortAttr = $(e.target).val();
        force.start();
    });
    </script>
  </body>
</html>
